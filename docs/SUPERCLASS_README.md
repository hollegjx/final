# CIFAR-100 è¶…ç±»è®­ç»ƒè¯´æ˜

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•åœ¨GCDï¼ˆGeneralized Category Discoveryï¼‰é¡¹ç›®ä¸­ä½¿ç”¨15ä¸ªè¶…ç±»çš„æ•°æ®åˆ’åˆ†è¿›è¡Œè®­ç»ƒã€‚

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

åŸºäºDCCLé¡¹ç›®çš„15ä¸ªè¶…ç±»åˆ’åˆ†æ–¹æ¡ˆï¼Œä¸ºGCDé¡¹ç›®æ·»åŠ äº†è¶…ç±»è®­ç»ƒåŠŸèƒ½ï¼š

- **15ä¸ªè¶…ç±»**: æ ‘æœ¨ã€èŠ±å‰ã€æ°´æœè”¬èœã€å“ºä¹³åŠ¨ç‰©ã€æµ·æ´‹åŠ¨ç‰©ã€æ˜†è™«èŠ‚è‚¢åŠ¨ç‰©ã€çˆ¬è¡ŒåŠ¨ç‰©ã€äººç±»ã€å®¶å…·ã€å®¹å™¨ã€è½¦è¾†ã€ç”µå­è®¾å¤‡ã€å»ºç­‘ç‰©ã€åœ°å½¢ã€å¤©æ°”ç°è±¡
- **æ•°æ®åˆ’åˆ†**: å…¼å®¹GCDé¡¹ç›®çš„è®­ç»ƒ/éªŒè¯/æµ‹è¯•é›†åˆ’åˆ†
- **è®­ç»ƒæ”¯æŒ**: å•ä¸ªè¶…ç±»è®­ç»ƒå’Œæ‰€æœ‰è¶…ç±»æ‰¹é‡è®­ç»ƒ

## ğŸ“‹ 15ä¸ªè¶…ç±»è¯¦æƒ…

| ID | è¶…ç±»åç§° | åŒ…å«CIFAR-100ç±»åˆ« | å·²çŸ¥ç±»æ•° | æœªçŸ¥ç±»æ•° |
|----|----------|-------------------|----------|----------|
| 0  | trees (æ ‘æœ¨) | [47, 52, 56, 59, 96] | 4 | 1 |
| 1  | flowers (èŠ±å‰) | [54, 62, 70, 82, 92] | 3 | 2 |
| 2  | fruits_vegetables (æ°´æœè”¬èœ) | [0, 51, 53, 57, 83] | 4 | 1 |
| 3  | mammals (å“ºä¹³åŠ¨ç‰©) | [3, 4, 21, 31, 34, 36, 38, 43, 50, 55, 63, 64, 65, 66, 72, 74, 75, 15, 19, 42, 80, 88, 97] | 20 | 3 |
| 4  | marine_animals (æµ·æ´‹åŠ¨ç‰©) | [1, 26, 27, 30, 32, 45, 67, 73, 95, 91] | 9 | 1 |
| 5  | insects_arthropods (æ˜†è™«èŠ‚è‚¢åŠ¨ç‰©) | [6, 7, 14, 24, 77, 18, 79, 99] | 6 | 2 |
| 6  | reptiles (çˆ¬è¡ŒåŠ¨ç‰©) | [44, 78, 29, 93] | 2 | 2 |
| 7  | humans (äººç±») | [11, 35, 46, 2, 98] | 3 | 2 |
| 8  | furniture (å®¶å…·) | [5, 20, 25, 84, 94] | 3 | 2 |
| 9  | containers (å®¹å™¨) | [16, 9, 10, 28, 61] | 5 | 0 |
| 10 | vehicles (è½¦è¾†) | [8, 13, 48, 58, 69, 81, 85, 89, 90] | 6 | 3 |
| 11 | electronic_devices (ç”µå­è®¾å¤‡) | [22, 39, 40, 41, 86, 87] | 4 | 2 |
| 12 | buildings (å»ºç­‘ç‰©) | [12, 17, 37, 76] | 4 | 0 |
| 13 | terrain (åœ°å½¢) | [33, 49, 60, 68, 71] | 5 | 0 |
| 14 | weather_phenomena (å¤©æ°”ç°è±¡) | [23] | 1 | 0 |

æ³¨æ„ï¼šéƒ¨åˆ†è¶…ç±»ï¼ˆå¦‚containersã€buildingsã€terrainã€weather_phenomenaï¼‰æ²¡æœ‰æœªçŸ¥ç±»ï¼Œä¸é€‚åˆæ ‡å‡†GCDè®­ç»ƒã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç”Ÿæˆæ•°æ®åˆ’åˆ†

```bash
# ç”Ÿæˆæ‰€æœ‰è¶…ç±»çš„æ•°æ®åˆ’åˆ†æ–‡ä»¶
python data_split_generator.py --output_dir ./data_splits
```

### 2. è®­ç»ƒå•ä¸ªè¶…ç±»

```bash
# è®­ç»ƒå“ºä¹³åŠ¨ç‰©è¶…ç±»
python train_superclass.py --superclass_name mammals --epochs 20

# è®­ç»ƒæ ‘æœ¨è¶…ç±»
python train_superclass.py --superclass_name trees --epochs 20

# è‡ªå®šä¹‰å‚æ•°è®­ç»ƒ
python train_superclass.py --superclass_name flowers \
                           --epochs 50 \
                           --batch_size 64 \
                           --lr 0.05 \
                           --prop_train_labels 0.8
```

### 3. è®­ç»ƒæ‰€æœ‰è¶…ç±»

```bash
# æ‰¹é‡è®­ç»ƒæ‰€æœ‰é€‚åˆçš„è¶…ç±»
python train_superclass.py --train_all_superclasses --epochs 20
```

### 4. æŸ¥çœ‹åŠŸèƒ½æ¼”ç¤º

```bash
# è¿è¡ŒåŠŸèƒ½æ¼”ç¤ºè„šæœ¬
python example_superclass_usage.py

# æ¼”ç¤ºå¢å¼ºè®­ç»ƒåŠŸèƒ½
python demo_enhanced_training.py
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
generalized-category-discovery-main/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ cifar100_superclass.py          # è¶…ç±»æ•°æ®é›†å®ç°
â”‚   â””â”€â”€ get_datasets.py                 # æ•°æ®é›†è·å–å‡½æ•°ï¼ˆå·²æ›´æ–°ï¼‰
â”œâ”€â”€ data_splits/                        # æ•°æ®åˆ’åˆ†æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ superclass_00_trees.json
â”‚   â”œâ”€â”€ superclass_01_flowers.json
â”‚   â”œâ”€â”€ ...
â”‚   â””â”€â”€ gcd_superclass_splits_summary.json
â”œâ”€â”€ utils/                              # è®­ç»ƒå·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ training_utils.py               # å¢å¼ºè®­ç»ƒåŠŸèƒ½
â”œâ”€â”€ methods/contrastive_training/
â”‚   â””â”€â”€ contrastive_training.py         # åŸç‰ˆGCDè®­ç»ƒï¼ˆå·²å¢å¼ºï¼‰
â”œâ”€â”€ train_superclass.py                 # è¶…ç±»è®­ç»ƒè„šæœ¬
â”œâ”€â”€ data_split_generator.py             # æ•°æ®åˆ’åˆ†ç”Ÿæˆå™¨
â”œâ”€â”€ example_superclass_usage.py         # ä½¿ç”¨ç¤ºä¾‹è„šæœ¬
â”œâ”€â”€ demo_enhanced_training.py           # å¢å¼ºåŠŸèƒ½æ¼”ç¤ºè„šæœ¬
â””â”€â”€ SUPERCLASS_README.md               # æœ¬æ–‡æ¡£
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### æ•°æ®é›†ç±»

- `CustomCIFAR100Superclass`: æ”¯æŒè¶…ç±»åˆ’åˆ†çš„CIFAR-100æ•°æ®é›†
- `get_single_superclass_datasets()`: è·å–å•ä¸ªè¶…ç±»çš„GCDæ•°æ®é›†
- `get_superclass_splits()`: è·å–æ‰€æœ‰è¶…ç±»çš„å·²çŸ¥/æœªçŸ¥ç±»åˆ’åˆ†

### è®­ç»ƒè„šæœ¬

- `train_superclass.py`: ä¸»è®­ç»ƒè„šæœ¬ï¼Œæ”¯æŒå•ä¸ªè¶…ç±»å’Œæ‰¹é‡è®­ç»ƒ
- `train_superclass()`: è¶…ç±»è®­ç»ƒå‡½æ•°
- `test_kmeans_superclass()`: è¶…ç±»K-meansè¯„ä¼°å‡½æ•°

### æ•°æ®åˆ’åˆ†

- `data_split_generator.py`: ç”ŸæˆGCDå…¼å®¹çš„æ•°æ®åˆ’åˆ†
- `GCDSuperclassSplitter`: æ•°æ®åˆ’åˆ†ç”Ÿæˆå™¨ç±»

### ğŸ†• å¢å¼ºè®­ç»ƒåŠŸèƒ½

- **è½®æ¬¡åˆ†å‰²æ˜¾ç¤º**: æ¯è½®ç”¨`=============`åˆ†å‰²ï¼Œæ˜¾ç¤ºæ—¶é—´æˆ³å’Œå·²ç”¨æ—¶é—´
- **æ€§èƒ½å·®è·ç›‘æ§**: å®æ—¶æ˜¾ç¤ºä¸å†å²æœ€ä½³æ¨¡å‹çš„æ€§èƒ½å·®è·
- **æ—©åœæœºåˆ¶**: 29è½®å†…`all_acc`æ— æ”¹å–„è‡ªåŠ¨åœæ­¢è®­ç»ƒ
- **è®­ç»ƒä¼šè¯ç®¡ç†**: ç»Ÿä¸€ç®¡ç†è®­ç»ƒè¿‡ç¨‹çš„æ‰€æœ‰è¾…åŠ©åŠŸèƒ½
- **ç¾åŒ–è¾“å‡º**: æ›´æ¸…æ™°çš„è®­ç»ƒè¿›åº¦å’Œæ€§èƒ½æŠ¥å‘Š

## ğŸ“Š æ•°æ®åˆ’åˆ†æ–¹æ¡ˆ

### è®­ç»ƒ/æµ‹è¯•åˆ†ç¦»
- **è®­ç»ƒé›†**: æ¥è‡ªCIFAR-100åŸå§‹è®­ç»ƒé›†ï¼ˆç´¢å¼•0-49999ï¼‰
- **æµ‹è¯•é›†**: æ¥è‡ªCIFAR-100åŸå§‹æµ‹è¯•é›†ï¼ˆç´¢å¼•50000-59999ï¼‰

### å·²çŸ¥/æœªçŸ¥ç±»åˆ’åˆ†
- **å·²çŸ¥ç±»**: ç±»åˆ«ID < 80ï¼ˆä¸GCDæ ‡å‡†ä¸€è‡´ï¼‰
- **æœªçŸ¥ç±»**: ç±»åˆ«ID >= 80ï¼ˆä¸GCDæ ‡å‡†ä¸€è‡´ï¼‰

### æ ‡ç­¾/æ— æ ‡ç­¾åˆ’åˆ†
- **æœ‰æ ‡ç­¾æ ·æœ¬**: è®­ç»ƒé›†ä¸­çš„å·²çŸ¥ç±»æ ·æœ¬ï¼ŒæŒ‰æ¯”ä¾‹åˆ’åˆ†ï¼ˆé»˜è®¤80%ï¼‰
- **æ— æ ‡ç­¾æ ·æœ¬**: è®­ç»ƒé›†ä¸­çš„æœªçŸ¥ç±»æ ·æœ¬

### è®­ç»ƒ/éªŒè¯åˆ’åˆ†
- **è®­ç»ƒé›†**: æœ‰æ ‡ç­¾æ ·æœ¬çš„80%
- **éªŒè¯é›†**: æœ‰æ ‡ç­¾æ ·æœ¬çš„20%

## ğŸ¨ ä½¿ç”¨ç¤ºä¾‹

### Pythonä»£ç ç¤ºä¾‹

```python
from data.cifar100_superclass import get_single_superclass_datasets, get_superclass_splits
from torchvision import transforms

# 1. æŸ¥çœ‹æ‰€æœ‰è¶…ç±»ä¿¡æ¯
superclass_splits = get_superclass_splits()
for name, info in superclass_splits.items():
    print(f"{name}: {len(info['known_classes'])} å·²çŸ¥ç±», {len(info['unknown_classes'])} æœªçŸ¥ç±»")

# 2. åŠ è½½å•ä¸ªè¶…ç±»æ•°æ®é›†
train_transform = transforms.Compose([
    transforms.ToTensor(),
    transforms.Normalize((0.5071, 0.4867, 0.4408), (0.2675, 0.2565, 0.2761))
])

datasets = get_single_superclass_datasets(
    superclass_name='mammals',
    train_transform=train_transform,
    test_transform=transforms.ToTensor(),
    prop_train_labels=0.8
)

print(f"è®­ç»ƒé›†: {len(datasets['train_labelled'])} æ ·æœ¬")
print(f"æµ‹è¯•é›†: {len(datasets['test'])} æ ·æœ¬")
```

### å‘½ä»¤è¡Œç¤ºä¾‹

```bash
# æŸ¥çœ‹å¯ç”¨è¶…ç±»
python -c "from data.cifar100_superclass import SUPERCLASS_NAMES; print(SUPERCLASS_NAMES)"

# è®­ç»ƒæ€§èƒ½æœ€å¥½çš„è¶…ç±»ï¼ˆå“ºä¹³åŠ¨ç‰©ï¼‰
python train_superclass.py --superclass_name mammals --epochs 50 --lr 0.1

# è®­ç»ƒæ‰€æœ‰è¶…ç±»å¹¶ä¿å­˜æœ€ä½³æ¨¡å‹
python train_superclass.py --train_all_superclasses --epochs 30 --save_best_thresh 0.5
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®ä¸‹è½½**: é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨ä¸‹è½½CIFAR-100æ•°æ®é›†
2. **GPUå†…å­˜**: å»ºè®®ä½¿ç”¨GPUè®­ç»ƒï¼Œè°ƒæ•´batch_sizeé¿å…å†…å­˜ä¸è¶³
3. **è¶…ç±»é€‰æ‹©**: æŸäº›è¶…ç±»æ²¡æœ‰æœªçŸ¥ç±»ï¼Œä¸é€‚åˆæ ‡å‡†GCDè®­ç»ƒ
4. **æ ‡ç­¾æ˜ å°„**: è¶…ç±»å†…éƒ¨ä½¿ç”¨è¿ç»­æ ‡ç­¾æ˜ å°„ï¼ˆ0, 1, 2, ...ï¼‰
5. **å…¼å®¹æ€§**: ä¸GCDåŸå§‹ä»£ç å®Œå…¨å…¼å®¹

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®é›†è·¯å¾„é”™è¯¯**
   ```bash
   # æ£€æŸ¥æ•°æ®è·¯å¾„é…ç½®
   python -c "from config import cifar_100_root; print(cifar_100_root)"
   ```

2. **è¶…ç±»åç§°é”™è¯¯**
   ```bash
   # æŸ¥çœ‹å¯ç”¨è¶…ç±»åç§°
   python -c "from data.cifar100_superclass import SUPERCLASS_NAMES; print(SUPERCLASS_NAMES)"
   ```

3. **GPUå†…å­˜ä¸è¶³**
   ```bash
   # å‡å°æ‰¹æ¬¡å¤§å°
   python train_superclass.py --superclass_name mammals --batch_size 32
   ```

4. **ä¾èµ–åº“ç¼ºå¤±**
   ```bash
   # å®‰è£…å¿…è¦ä¾èµ–
   pip install torch torchvision scikit-learn tqdm
   ```

### æ£€æŸ¥å®‰è£…

```bash
# è¿è¡Œé›†æˆæ£€æŸ¥
python example_superclass_usage.py
```

## ğŸ“ˆ æ€§èƒ½åŸºå‡†

åŸºäºåˆæ­¥æµ‹è¯•ï¼Œæ¨èçš„è¶…ç±»è®­ç»ƒé…ç½®ï¼š

- **æœ€ä½³è¶…ç±»**: mammalsï¼ˆå“ºä¹³åŠ¨ç‰©ï¼‰ - æ•°æ®é‡å¤§ï¼Œç±»åˆ«å¹³è¡¡
- **è®­ç»ƒè½®æ•°**: 20-50 epochs
- **å­¦ä¹ ç‡**: 0.05-0.1
- **æ‰¹æ¬¡å¤§å°**: 64-128
- **æœ‰æ ‡ç­¾æ¯”ä¾‹**: 0.8

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [GCDåŸå§‹è®ºæ–‡](https://arxiv.org/abs/2201.02609)
- [DCCLé¡¹ç›®](ç›¸å…³é“¾æ¥)
- [CIFAR-100æ•°æ®é›†](https://www.cs.toronto.edu/~kriz/cifar.html)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ”¹è¿›è¶…ç±»è®­ç»ƒåŠŸèƒ½ã€‚

## ğŸ†• å¢å¼ºè®­ç»ƒåŠŸèƒ½è¯¦è§£

### è½®æ¬¡åˆ†å‰²æ˜¾ç¤º

æ¯ä¸ªè®­ç»ƒè½®æ¬¡éƒ½ç”¨é†’ç›®çš„åˆ†å‰²çº¿æ ‡è¯†ï¼š

```
================================================================================
ğŸ• ç¬¬ 1/50 è½® | æ—¶é—´: 14:30:25 | å·²ç”¨æ—¶: 0:05:30
================================================================================
```

### æ€§èƒ½ç›‘æ§å’Œå·®è·æ˜¾ç¤º

è®­ç»ƒè¿‡ç¨‹ä¸­å®æ—¶æ˜¾ç¤ºè¯¦ç»†çš„æ€§èƒ½ä¿¡æ¯ï¼š

```
ğŸ“Š ç¬¬1è½®æ€§èƒ½æ€»ç»“:
â”Œâ”€ è®­ç»ƒæŸå¤±: 1.2345
â”œâ”€ è®­ç»ƒå‡†ç¡®ç‡: 0.8234
â”œâ”€ è®­ç»ƒé›†è¯„ä¼°: All 0.7123 | Old 0.6890 | New 0.7456
â””â”€ æµ‹è¯•é›†è¯„ä¼°: All 0.6789 | Old 0.6234 | New 0.7345

ğŸ¯ ä¸æœ€ä½³æ¨¡å‹å·®è·:
â”œâ”€ All ACCå·®è·: -0.0234
â”œâ”€ Old ACCå·®è·: -0.0156
â””â”€ New ACCå·®è·: -0.0089

ğŸ† å†å²æœ€ä½³ (ç¬¬3è½®):
â”œâ”€ Best All ACC: 0.7023
â”œâ”€ Best Old ACC: 0.6390
â””â”€ Best New ACC: 0.7434
```

### æ—©åœæœºåˆ¶

- **ç›‘æ§æŒ‡æ ‡**: `test_all_acc` (æµ‹è¯•é›†æ€»ä½“å‡†ç¡®ç‡)
- **å®¹å¿è½®æ•°**: 29è½®æ— æ”¹å–„è‡ªåŠ¨åœæ­¢
- **æœ€å°æ”¹å–„**: 0.0001 (é»˜è®¤)

```
ğŸ¯ test_all_accæ–°æœ€ä½³: 0.7234 (ç¬¬5è½®)
â° test_all_accæ— æ”¹å–„: 25/29 è½®
ğŸ›‘ æ—©åœè§¦å‘: test_all_accå·²29è½®æ— æ”¹å–„
```

### è®­ç»ƒå®Œæˆæ€»ç»“

```
ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ è®­ç»ƒå®Œæˆ ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰
ğŸ›‘ æ—©åœäºç¬¬35è½® (æ€»è®¡åˆ’50è½®)
â±ï¸  æ€»ç”¨æ—¶: 2:15:30
ğŸ† æœ€ä½³æ€§èƒ½ (ç¬¬23è½®):
â”œâ”€ Best All ACC: 0.7234
â”œâ”€ Best Old ACC: 0.6890
â””â”€ Best New ACC: 0.7578
â° ç»“æŸæ—¶é—´: 2024-01-15 16:45:55
================================================================================
```

### ä½¿ç”¨å¢å¼ºåŠŸèƒ½

å¢å¼ºåŠŸèƒ½å·²è‡ªåŠ¨é›†æˆåˆ°æ‰€æœ‰è®­ç»ƒè„šæœ¬ä¸­ï¼š

1. **åŸç‰ˆGCDè®­ç»ƒ**ï¼ˆå·²å¢å¼ºï¼‰:
   ```bash
   python methods/contrastive_training/contrastive_training.py --dataset_name cifar100 --epochs 100
   ```

2. **è¶…ç±»è®­ç»ƒ**ï¼ˆå·²å¢å¼ºï¼‰:
   ```bash
   python train_superclass.py --superclass_name mammals --epochs 50
   ```

3. **åŠŸèƒ½æ¼”ç¤º**:
   ```bash
   python demo_enhanced_training.py --demo all
   ```

### è‡ªå®šä¹‰æ—©åœå‚æ•°

å¯ä»¥åœ¨åˆ›å»º`TrainingSession`æ—¶è‡ªå®šä¹‰æ—©åœå‚æ•°ï¼š

```python
# è‡ªå®šä¹‰å®¹å¿è½®æ•°ä¸º50è½®
training_session = TrainingSession(args, enable_early_stopping=True, patience=50)

# ç¦ç”¨æ—©åœ
training_session = TrainingSession(args, enable_early_stopping=False)
```

## ğŸ“„ è®¸å¯è¯

ä¸GCDé¡¹ç›®ä¿æŒä¸€è‡´çš„è®¸å¯è¯ã€‚