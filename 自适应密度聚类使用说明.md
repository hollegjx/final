# è‡ªé€‚åº”å¯†åº¦èšç±»ä½¿ç”¨è¯´æ˜

## å¿«é€Ÿå¼€å§‹

### åŸºæœ¬å‘½ä»¤æ ¼å¼
```bash
python cluster_with_backbone_features.py \
    --model_path "ä½ çš„æ¨¡å‹è·¯å¾„.pt" \
    --eval_mode superclass \
    --superclass_name è¶…ç±»åç§° \
    --gpu GPUç¼–å·
```

### å®é™…ä½¿ç”¨ç¤ºä¾‹

#### 1. å•ä¸ªè¶…ç±»è¯„ä¼°
```bash
python cluster_with_backbone_features.py \
    --model_path "/path/to/your/model.pt" \
    --eval_mode superclass \
    --superclass_name terrain \
    --gpu 3
```

#### 2. å…¨æ•°æ®é›†è¯„ä¼°
```bash
python cluster_with_backbone_features.py \
    --model_path "/path/to/your/model.pt" \
    --eval_mode full \
    --gpu 3
```

#### 3. æ‰€æœ‰è¶…ç±»æ‰¹é‡è¯„ä¼°
```bash
python cluster_with_backbone_features.py \
    --model_path "/path/to/your/model.pt" \
    --eval_mode all_superclasses \
    --gpu 3
```

#### 4. è¶…å‚æ•°è°ƒä¼˜ç¤ºä¾‹
```bash
# æé«˜å¯†åº¦é˜ˆå€¼ï¼Œå‡å°‘è¿‡åº¦åˆ†å‰²
python cluster_with_backbone_features.py \
    --model_path "/path/to/your/model.pt" \
    --eval_mode superclass \
    --superclass_name terrain \
    --density_percentile 80 \
    --min_cluster_size 15 \
    --gpu 3

# è°ƒæ•´kè¿‘é‚»å’Œæƒé‡å‚æ•°
python cluster_with_backbone_features.py \
    --model_path "/path/to/your/model.pt" \
    --eval_mode superclass \
    --superclass_name terrain \
    --k_neighbors 8 \
    --lambda_weight 0.8 \
    --gpu 3

# é’ˆå¯¹terrainè¶…ç±»çš„ä¼˜åŒ–é…ç½®
python cluster_with_backbone_features.py \
    --model_path "/path/to/your/model.pt" \
    --eval_mode superclass \
    --superclass_name terrain \
    --density_percentile 75 \
    --k_neighbors 8 \
    --min_cluster_size 15 \
    --lambda_weight 0.8 \
    --gpu 3
```

## å‚æ•°è¯´æ˜

### åŸºç¡€å‚æ•°
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--model_path` | str | å¿…éœ€ | è®­ç»ƒå¥½çš„æ¨¡å‹æƒé‡æ–‡ä»¶è·¯å¾„ |
| `--eval_mode` | str | 'full' | è¯„ä¼°æ¨¡å¼ï¼š'full'ã€'superclass'ã€'all_superclasses' |
| `--superclass_name` | str | None | è¶…ç±»åç§°ï¼ˆsuperclassæ¨¡å¼æ—¶å¿…éœ€ï¼‰ |
| `--gpu` | int | 0 | GPUè®¾å¤‡ç¼–å· |
| `--batch_size` | int | 128 | æ‰¹æ¬¡å¤§å° |
| `--eval_funcs` | list | ['v1'] | è¯„ä¼°å‡½æ•°ç‰ˆæœ¬ |

### èšç±»ç®—æ³•è¶…å‚æ•°
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--k_neighbors` | int | è‡ªé€‚åº” | kè¿‘é‚»æ•°é‡ï¼Œå½±å“èšç±»è¿é€šæ€§ |
| `--density_percentile` | int | 70 | å¯†åº¦é˜ˆå€¼ç™¾åˆ†ä½æ•°ï¼Œæ§åˆ¶æ ¸å¿ƒç‚¹æ•°é‡ |
| `--lambda_weight` | float | 0.7 | åŸå‹ç½®ä¿¡åº¦æƒé‡ (0-1ä¹‹é—´) |
| `--min_cluster_size` | int | è‡ªé€‚åº” | æœ€å°èšç±»å¤§å°ï¼Œé¿å…ç¢ç‰‡èšç±» |
| `--standardize_features` | bool | True | æ˜¯å¦æ ‡å‡†åŒ–ç‰¹å¾ |

## å¯ç”¨è¶…ç±»åç§°
```
trees, flowers, fruits_vegetables, mammals, marine_animals,
insects_arthropods, reptiles, humans, furniture, containers,
vehicles, electronic_devices, buildings, terrain, weather_phenomena
```

## è¾“å‡ºç»“æœè§£è¯»

### ä¸»è¦æŒ‡æ ‡
- **All ACC**: æ•´ä½“èšç±»å‡†ç¡®ç‡
- **Old ACC**: å·²çŸ¥ç±»åˆ«å‡†ç¡®ç‡
- **New ACC**: æœªçŸ¥ç±»åˆ«å‡†ç¡®ç‡
- **å‘ç°èšç±»æ•°**: ç®—æ³•è‡ªåŠ¨å‘ç°çš„èšç±»æ•°é‡

### èšç±»è¯¦æƒ…
æ¯ä¸ªèšç±»æ˜¾ç¤ºï¼š
- èšç±»å¤§å°å’Œå·²çŸ¥/æœªçŸ¥æ ·æœ¬æ¯”ä¾‹
- åŸå§‹æ ‡ç­¾åˆ†å¸ƒå’Œè¶…ç±»å†…æ ‡ç­¾åˆ†å¸ƒ
- èšç±»çº¯åº¦å’Œä¸»å¯¼ç±»åˆ«
- èšç±»ç±»å‹ï¼šğŸŸ¢çº¯å·²çŸ¥ / ğŸ”´çº¯æœªçŸ¥ / ğŸŸ¡æ··åˆ

## æ•…éšœæ’é™¤

### å¸¸è§é”™è¯¯
1. **cuDNNé”™è¯¯**: å¦‚æœé‡åˆ°"Unable to find a valid cuDNN algorithm"é”™è¯¯ï¼Œå°è¯•ï¼š
   - é™ä½batch_sizeï¼š`--batch_size 64`
   - æ¸…ç†GPUå†…å­˜ï¼šé‡å¯Pythonè¿›ç¨‹
   - åˆ‡æ¢åˆ°å…¶ä»–GPUï¼šä¿®æ”¹`--gpu`å‚æ•°

2. **å†…å­˜ä¸è¶³**: è°ƒæ•´`--batch_size`å‚æ•°ï¼ˆå»ºè®®å€¼ï¼š32-128ï¼‰

3. **æ¨¡å‹è·¯å¾„é”™è¯¯**: ç¡®ä¿æ¨¡å‹æ–‡ä»¶å­˜åœ¨ä¸”ä¸º.ptæ ¼å¼

## è¶…å‚æ•°è°ƒä¼˜æŒ‡å—

### å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### 1. èšç±»æ•°è¿‡å¤šï¼ˆè¿‡åº¦åˆ†å‰²ï¼‰
**ç°è±¡**: å‘ç°çš„èšç±»æ•°è¿œå¤§äºçœŸå®ç±»åˆ«æ•°
**è§£å†³**:
- æé«˜ `--density_percentile 80` ï¼ˆå‡å°‘æ ¸å¿ƒç‚¹ï¼‰
- å¢å¤§ `--min_cluster_size 15` ï¼ˆåˆå¹¶å°èšç±»ï¼‰
- å¢åŠ  `--k_neighbors 8` ï¼ˆå¢å¼ºè¿é€šæ€§ï¼‰

#### 2. èšç±»æ•°è¿‡å°‘ï¼ˆæ¬ åˆ†å‰²ï¼‰
**ç°è±¡**: å‘ç°çš„èšç±»æ•°å°äºçœŸå®ç±»åˆ«æ•°
**è§£å†³**:
- é™ä½ `--density_percentile 60` ï¼ˆå¢åŠ æ ¸å¿ƒç‚¹ï¼‰
- å‡å° `--min_cluster_size 5` ï¼ˆä¿ç•™å°èšç±»ï¼‰
- å‡å°‘ `--k_neighbors 5` ï¼ˆå¢åŠ æ•æ„Ÿæ€§ï¼‰

#### 3. æ··åˆèšç±»è¿‡å¤š
**ç°è±¡**: å·²çŸ¥ç±»å’ŒæœªçŸ¥ç±»æ··åœ¨ä¸€èµ·
**è§£å†³**:
- æé«˜ `--lambda_weight 0.8` ï¼ˆå¢å¼ºåŸå‹æŒ‡å¯¼ï¼‰
- ä¼˜åŒ–ç‰¹å¾è¡¨ç¤ºè´¨é‡
- æ£€æŸ¥æ ‡ç­¾å…¼å®¹æ€§é€»è¾‘

### å‚æ•°å½±å“æ€»ç»“
- **density_percentile**: ä¸»è¦å½±å“èšç±»æ•°é‡
- **k_neighbors**: å½±å“èšç±»è¿é€šæ€§å’Œç¨³å®šæ€§
- **min_cluster_size**: æ§åˆ¶æœ€ç»ˆèšç±»çš„æœ€å°è§„æ¨¡
- **lambda_weight**: å¹³è¡¡å…¨å±€å’Œå±€éƒ¨ä¿¡æ¯

## ç®—æ³•ç‰¹ç‚¹

- **è‡ªåŠ¨å‘ç°èšç±»æ•°**: æ— éœ€é¢„è®¾èšç±»æ•°é‡
- **å¯†åº¦é©±åŠ¨**: åŸºäºæ ·æœ¬å±€éƒ¨å¯†åº¦è¿›è¡Œèšç±»
- **åŠç›‘ç£**: åˆ©ç”¨å·²çŸ¥æ ‡ç­¾ä¿¡æ¯æŒ‡å¯¼èšç±»
- **è¯¦ç»†åˆ†æ**: æä¾›å®Œæ•´çš„èšç±»å†…éƒ¨åˆ†å¸ƒåˆ†æ
- **å‚æ•°å¯è°ƒ**: æ”¯æŒå‘½ä»¤è¡Œè¶…å‚æ•°è°ƒä¼˜