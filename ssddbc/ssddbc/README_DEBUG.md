# 单样本聚类调试模块使用说明

## 文件说明

- `debug_single_clusters.py`: 单样本聚类调试模块（调试完成后可删除）

## 功能

该模块用于分析为什么会出现大量单样本聚类，自动诊断以下原因：

### 分析的原因类型

1. **孤立点（isolated）**
   - 没有任何高密度邻居
   - 所有邻居都是低密度点

2. **与所有高密度邻居有标签冲突（label_conflict_with_all_neighbors）**
   - 样本有标签
   - 所有高密度邻居都有不同的标签

3. **所有高密度邻居已被分配（neighbors_already_assigned）**
   - 所有高密度邻居都已经被分配到其他簇
   - 处理顺序问题导致

4. **冲突解决拒绝合并（conflict_resolution_rejected）**
   - 有已分配的高密度邻居
   - 但冲突解决算法判断不应该合并

5. **处理顺序问题（processed_late）**
   - 其他未分类原因

## 输出示例

```
================================================================================
🔍 单样本聚类调试分析
================================================================================
发现 150 个单样本聚类

--------------------------------------------------------------------------------
📊 单样本聚类原因统计:
--------------------------------------------------------------------------------
  孤立点（无高密度邻居）: 45 个 (30.0%)
    示例:
      1. 样本123 (标签=5, 密度=0.0234)
         详情: 没有高密度邻居（10个邻居都是低密度）
      2. 样本456 (无标签, 密度=0.0198)
         详情: 没有高密度邻居（10个邻居都是低密度）

  与所有高密度邻居有标签冲突: 60 个 (40.0%)
    示例:
      1. 样本234 (标签=3, 密度=0.0456)
         详情: 与所有8个高密度邻居都有标签冲突

  所有高密度邻居已被分配: 30 个 (20.0%)
    示例:
      1. 样本345 (标签=7, 密度=0.0378)
         详情: 所有5个高密度邻居都已被分配到其他簇

  冲突解决拒绝合并: 15 个 (10.0%)
    示例:
      1. 样本567 (标签=9, 密度=0.0512)
         详情: 有3个已分配的高密度邻居，但冲突解决算法拒绝合并
--------------------------------------------------------------------------------

📊 按真实标签统计单样本聚类:
--------------------------------------------------------------------------------
  类别 3: 25 个单样本聚类 (16.7%)
  类别 7: 20 个单样本聚类 (13.3%)
  类别 5: 18 个单样本聚类 (12.0%)
  ...
================================================================================
```

## 扩展决策标记

每次邻居扩展决策都会被标记：

- `expand`: 邻居被加入簇
- `skip`: 邻居被跳过（标签冲突、非高密度等）
- `merge`: 簇合并
- `reject`: 冲突解决拒绝合并

## 调用位置

调试分析在 `adaptive_ssddbc.py` 中被调用，位于：
- `analyze_ssddbc_clustering_result()` 之后
- 建立原型之前

这样可以确保在所有聚类详细信息输出后，再输出单样本聚类的统计分析。

## 删除说明

调试完成后，可以删除以下内容：

1. **删除文件**：`debug_single_clusters.py`

2. **在 `ssddbc.py` 中删除**：
   - 第11行：`from .debug_single_clusters import add_expansion_debug_info`
   - 第57行：`debug_info_collector = {}`
   - 第123-124行、135-140行、166-175行：所有 `add_expansion_debug_info()` 调用

3. **在 `adaptive_ssddbc.py` 中删除**：
   - 第18行：`from .debug_single_clusters import analyze_single_sample_clusters`
   - 第260-264行：`analyze_single_sample_clusters()` 调用

4. **删除本说明文件**：`README_DEBUG.md`
